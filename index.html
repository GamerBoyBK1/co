<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title id="pageTitle">CoRamTix UPI QR Generator</title>

<style>
  /* Base & Layout */
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #5b2bff;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }

  .container {
    width: 90%;
    max-width: 480px;
    background: white;
    margin: 25px 0;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3); /* Deeper shadow */
  }

  /* Form Elements */
  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
  }

  input {
    width: calc(100% - 24px);
    padding: 12px;
    border-radius: 12px;
    border: 1px solid #ccc;
    margin-bottom: 20px;
    transition: border-color 0.3s, box-shadow 0.3s;
    font-size: 16px;
  }

  input:focus {
    border-color: #5b2bff;
    box-shadow: 0 0 0 3px rgba(91, 43, 255, 0.3);
    outline: none;
  }

  /* QR Box Styling - UNIQUE Gradient */
  .qr-box {
    /* Vertical Gradient Background */
    background: linear-gradient(180deg, #7200ff 0%, #5b2bff 100%); 
    color: white;
    padding: 25px;
    border-radius: 20px;
    text-align: center;
    margin-top: 30px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
    transition: opacity 0.4s ease-in-out;
  }
  
  /* Unique Text Style */
  .qr-box h2 {
    margin-top: 5px; 
    font-weight: 800;
    letter-spacing: 1px;
    /* Subtle White Text Shadow */
    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.4); 
  }


  /* Unique QR Canvas Style */
  #qrcode {
    background: white;
    padding: 15px;
    border-radius: 15px;
    margin-top: 15px;
    display: inline-block;
    /* Inner shadow for depth */
    box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.2); 
  }

  /* Unique Payment Details Box */
  .payment-details {
    margin-top: 18px;
    /* More solid, frosted background */
    background: rgba(255, 255, 255, 0.25); 
    padding: 15px;
    border-radius: 15px;
    text-align: left;
    font-size: 1.1em;
    backdrop-filter: blur(5px); /* Added blur for "frosted glass" effect */
    border: 1px solid rgba(255, 255, 255, 0.3);
  }

  .payment-details p {
    margin: 5px 0;
    font-weight: 500;
  }

  /* Buttons */
  .btn-area {
    margin-top: 25px;
    display: flex;
    gap: 12px; /* Slightly more gap */
    justify-content: center;
  }

  button {
    padding: 12px 18px;
    font-size: 16px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s, transform 0.2s, opacity 0.3s;
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
  }

  button:hover:not(:disabled) {
    transform: translateY(-3px); /* More pronounced lift */
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
  }

  button:active {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }

  button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  /* Specific Button Styles */
  #generateBtn {
    background: #5b2bff;
    color: white;
    width: 100%;
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 10px;
  }

  #downloadBtn {
    background: #28a745;
    color: white;
  }

  #shareBtn {
    background: #6a8bff;
    color: white;
  }
  
  #resetBtn {
    background: #dc3545;
    color: white;
  }

  /* Logo & Misc */
  .top-logo {
    width: 60px; /* Slightly larger logo */
    margin-bottom: 10px;
  }
  
  #errorMessage {
    color: #dc3545;
    margin-bottom: 15px;
    font-weight: bold;
    text-align: center;
  }

</style>
</head>
<body>

<div class="container">

  <label for="amount">Amount (₹)</label>
  <input id="amount" type="number" placeholder="Enter amount (e.g., 100.50)" min="1" step="0.01">

  <label for="note">Payment Note (Optional)</label>
  <input id="note" type="text" placeholder="Payment for CoRamTix services">

  <div id="errorMessage" style="display:none;">Please enter a valid amount.</div>

  <button id="generateBtn" disabled>
    Generate Unique QR
  </button>
  
  <button id="resetBtn" style="width: 100%;">
    Reset Form
  </button>

  <div class="qr-box" id="qrBox" style="opacity:0; display:none;">

    <svg class="top-logo" viewBox="0 0 24 24">
      <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"
            fill="#FFFFFF"
            stroke="#FFFFFF"
            stroke-width="0.8"/>
    </svg>

    <h2>CORAMTIX</h2>

    <canvas id="qrcode"></canvas>

    <div class="payment-details">
      <p><strong>Amount:</strong> ₹<span id="displayAmount">0.00</span></p>
      <p><strong>Note:</strong> <span id="displayNote">Payment</span></p>
    </div>

    <div class="btn-area" id="buttonsBox">
      <button id="downloadBtn">Download QR</button>
      <button id="shareBtn">Share QR</button>
    </div>

  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const amountInput = document.getElementById("amount");
    const noteInput = document.getElementById("note");
    const generateBtn = document.getElementById("generateBtn");
    const resetBtn = document.getElementById("resetBtn");
    const qrBox = document.getElementById("qrBox");
    const qrcodeCanvas = document.getElementById("qrcode");
    const displayAmount = document.getElementById("displayAmount");
    const displayNote = document.getElementById("displayNote");
    const downloadBtn = document.getElementById("downloadBtn");
    const shareBtn = document.getElementById("shareBtn");
    const buttonsBox = document.getElementById("buttonsBox");
    const errorMessage = document.getElementById("errorMessage");
    const pageTitle = document.getElementById("pageTitle");

    // --- Input Handling & Validation ---

    amountInput.addEventListener('input', () => {
        const amount = parseFloat(amountInput.value);
        const isValid = amount > 0;
        generateBtn.disabled = !isValid;
        errorMessage.style.display = 'none';
        
        // Ensure amount is formatted correctly for display
        if(amountInput.value) {
            // Keep input as is for easy editing, just check for validity
        }
    });

    // --- Core QR Generation Logic ---

    const generateQR = () => {
        const amount = amountInput.value.trim();
        let note = noteInput.value.trim() || "Payment";

        if (!amount || parseFloat(amount) <= 0) {
            errorMessage.style.display = 'block';
            return;
        }
        
        // Format the amount for the UPI link to 2 decimal places
        const formattedAmount = parseFloat(amount).toFixed(2);

        // Clean up the note for URL encoding
        note = encodeURIComponent(note.replace(/[^a-zA-Z0-9\s]/g, ''));
        
        // Standard UPI QR format
        const upi = `upi://pay?pa=coramtix@ptaxis&pn=CoRamTix&am=${formattedAmount}&tn=${note}&cu=INR`;

        // Generate the QR code
        QRCode.toCanvas(qrcodeCanvas, upi, { 
            width: 220, 
            errorCorrectionLevel: 'H' 
        })
        .then(() => {
            // Update display details
            displayAmount.innerText = formattedAmount;
            displayNote.innerText = decodeURIComponent(note);

            // Show QR box with fade-in effect
            qrBox.style.display = "block";
            setTimeout(() => {
                qrBox.style.opacity = 1;
            }, 10); // Small delay to trigger transition

            // Update Page Title
            pageTitle.innerText = `QR: ₹${displayAmount.innerText} - ${displayNote.innerText}`;
            
        })
        .catch(err => {
            console.error('Error generating QR code:', err);
            alert('Could not generate QR code. Please check your inputs.');
        });
    }

    // --- Download/Share Utility Functions ---
    // (These functions are kept from the previous response as they handle the image capture correctly)

    const toggleButtons = (hide) => {
        buttonsBox.style.display = hide ? "none" : "flex";
    }

    const captureAndProcess = async (callback) => {
        toggleButtons(true);

        // Wait a moment for any potential DOM redraw after hiding buttons
        await new Promise(resolve => setTimeout(resolve, 150)); 

        try {
            const canvas = await html2canvas(qrBox, {
                // IMPORTANT: Ensure the capture background matches the gradient for a clean image
                backgroundColor: "#7200ff", 
                scale: 3,
                width: qrBox.offsetWidth,
                height: qrBox.offsetHeight
            });

            await callback(canvas);

        } catch (error) {
            console.error('Error during QR box capture:', error);
            alert('Failed to capture QR image.');
        } finally {
            toggleButtons(false);
        }
    }

    const downloadQR = async () => {
        await captureAndProcess((canvas) => {
            const link = document.createElement("a");
            link.download = `CoRamTix_QR_${displayAmount.innerText}.png`;
            link.href = canvas.toDataURL("image/png");
            link.click();
        });
    }

    const shareQR = async () => {
        await captureAndProcess(async (canvas) => {
            canvas.toBlob(async (blob) => {
                if (!blob) return alert("Error creating image file for sharing.");
                
                const filename = `CoRamTix_QR_${displayAmount.innerText}.png`;
                const file = new File([blob], filename, { type: "image/png" });

                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        title: "CoRamTix UPI QR Code",
                        text: `Scan to pay ₹${displayAmount.innerText} to CoRamTix. Note: ${displayNote.innerText}`,
                        files: [file]
                    });
                } else {
                    alert("Web Share API not supported or failed. Downloading instead.");
                    // Fallback to download
                    downloadQR();
                }
            }, "image/png");
        });
    }
    
    // --- Reset Function ---
    const resetForm = () => {
        amountInput.value = '';
        noteInput.value = '';
        generateBtn.disabled = true;
        errorMessage.style.display = 'none';
        qrBox.style.opacity = 0;
        // Wait for transition to finish before hiding completely
        setTimeout(() => {
            qrBox.style.display = "none";
        }, 400); 
        pageTitle.innerText = "CoRamTix UPI QR Generator";
    }

    // --- Attach Event Listeners ---
    generateBtn.addEventListener('click', generateQR);
    downloadBtn.addEventListener('click', downloadQR);
    shareBtn.addEventListener('click', shareQR);
    resetBtn.addEventListener('click', resetForm);
});
</script>

</body>
</html>
