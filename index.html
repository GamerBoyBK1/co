<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CoRamTix UPI QR</title>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #f4f4f4;
    color: #333;
    text-align: center;
    padding: 40px;
  }
  .container {
    background: #fff;
    border-radius: 16px;
    padding: 30px;
    max-width: 400px;
    margin: auto;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
  }
  input {
    width: 80%;
    padding: 10px;
    margin: 8px 0;
    border-radius: 8px;
    border: 1px solid #ccc;
    outline: none;
    text-align: center;
  }
  button {
    background: #6c63ff;
    border: none;
    color: #fff;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 10px;
  }
  button:hover { background: #7c75ff; }
  .qr-box {
    background: #7200ff; /* Purple background as requested */
    border-radius: 12px;
    margin-top: 20px;
    padding: 20px;
    display: inline-block;
    color: white;
    width: 260px;
  }
  .logo-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin-bottom: 15px;
  }
  .logo-svg {
    width: 40px;
    height: 40px;
    margin-bottom: 8px;
  }
  #qrcode {
    margin: 10px 0;
    background: white;
    padding: 10px;
    border-radius: 8px;
    display: block;
    margin-left: auto;
    margin-right: auto;
  }
  h3 {
    font-weight: 600;
    margin: 0;
    color: white;
    font-size: 18px;
  }
  .payment-text {
    font-size: 18px;
    font-weight: 500;
    margin-top: 10px;
  }
</style>
</head>
<body>

<div class="container">
  <h2>üí∞ CoRamTix UPI QR Generator</h2>
  <input type="number" id="amount" placeholder="Enter Amount (‚Çπ)">
  <input type="text" id="note" placeholder="Enter Note (e.g. Minecraft Hosting)">
  <br>
  <button onclick="generateQR()">Generate QR</button>
  <button id="downloadBtn" style="display:none;" onclick="downloadQR()">‚¨áÔ∏è Download QR</button>
  
  <div class="qr-box" id="qrBox" style="display:none;">
    <div class="logo-container">
      <svg class="logo-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" 
              fill="#FFFFFF" 
              stroke="#FFFFFF" 
              stroke-width="0.5"/>
      </svg>
      <h3>CORAMTIX</h3>
    </div>
    <canvas id="qrcode"></canvas>
    <p class="payment-text">UPI Payment</p>
  </div>

  <p id="upiLink"></p>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
function generateQR() {
  const upi_id = "coramtix@ptaxis";
  const name = "CoRamTix";
  const amount = document.getElementById("amount").value;
  const note = document.getElementById("note").value || "Payment";

  if (!amount) {
    alert("Please enter amount");
    return;
  }

  const upiLink = `upi://pay?pa=${encodeURIComponent(upi_id)}&pn=${encodeURIComponent(name)}&tn=${encodeURIComponent(note)}&am=${encodeURIComponent(amount)}&cu=INR`;

  const canvas = document.getElementById("qrcode");
  
  // Clear previous QR code
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  QRCode.toCanvas(canvas, upiLink, {
    width: 200,
    margin: 1,
    color: {
      dark: "#000000",
      light: "#ffffff"
    }
  }, function (error) {
    if (error) {
      console.error(error);
      alert("Error generating QR code");
    } else {
      document.getElementById("qrBox").style.display = "inline-block";
      document.getElementById("downloadBtn").style.display = "inline-block";
    }
  });

  document.getElementById("upiLink").innerHTML = 
    `<a href="${upiLink}" target="_blank" style="color:#6c63ff;">üîó Pay ‚Çπ${amount} Now</a>`;
}

function downloadQR() {
  const qrBox = document.getElementById("qrBox");
  
  // Ensure QR code is fully rendered
  setTimeout(() => {
    html2canvas(qrBox, {
      backgroundColor: '#7200ff',
      scale: 2, // Higher resolution
      useCORS: true,
      logging: false
    }).then(canvas => {
      const link = document.createElement("a");
      link.download = `CoRamTix_UPI_QR_${Date.now()}.png`;
      link.href = canvas.toDataURL("image/png");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }).catch(error => {
      console.error("Error capturing QR code:", error);
      alert("Error downloading QR code. Please try again.");
    });
  }, 100);
}
</script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

</body>
</html>
